name: Authentication
description: Endpoints for user authentication
endpoints:
  - httpMethods: [ "POST" ]
    uri: v8/authenticate
    metadata:
      title: 1. Obtain Initial Token
      description: |
        Authenticate with email and password to get an initial token. This token is then exchanged for an Application JWT which expires within two hours. This token however is valid for one year to continusly optain new Application JWTs without re-authenticating.

        JWT Payload:
        ```
        {
          "iss": "http://api.vanmoof-api.com",
          "iat": {issued_at_timestamp},
          "nbf": {not_before_timestamp},
          "exp": {expiration_timestamp},
          "user": {userID},
          "api_key": 3,
          "device": null,
          "refresh_token": "{UUIDv4}"
        }
        ```
      authenticated: false
    headers:
      Authorization: Basic dXNlckBleGFtcGxlLmNvbTpwYXNzd29yZA==
      Api-Key: fcb38d47-f14b-30cf-843b-26283f6a5819
    bodyParameters: []
    responses:
      - status: 200
        description: Success
        content: '{"token":"{TOKEN}","refreshToken":"UUIDv4"}'
      - status: 401
        description: Unauthorized
        content: '{"error":"AuthenticationException","message":"Invalid Credentials"}'
      - status: 422
        description: Unprocessable Entity
        content: '{"error":"Please provide your ''Api-Key'' header. You can obtain an API key from VanMoof. For more information see the documentation: http:\/\/api.vanmoof-api.com\/apidoc\/my\/pretty","message":"Please provide an API key"}'

  - httpMethods: [ "GET" ]
    uri: v8/getApplicationToken
    metadata:
      title: 2. Obtain Application Token
      description: |
        Exchange the initial token for an Application JWT used for subsequent requests.

        JWT payload:
        ```json
        {
          "iss": "http://api.vanmoof-api.com",
          "iat": {issued_at_timestamp},
          "nbf": {not_before_timestamp},
          "exp": {expiration_timestamp},
          "user": "{email}",
          "uuid": "{UUIDv3}",
          "bikes": [
            {bikeID},
          ],
          "owner": [
            "{FrameNumber}"
          ]
        }
        ```
      authenticated: true
    headers:
      Authorization: Bearer {INITIAL_AUTH_TOKEN}
      Api-Key: fcb38d47-f14b-30cf-843b-26283f6a5819
    responses:
      - status: 200
        description: Success
        content: '{"token": "{JWT_TOKEN}"}'
      - status: 401
        description: Unauthorized
        content: '{"error": "UnexpectedError","message": "An unexpected error occurred. Please contact support if this problem persists."}'
      - status: 401
        description: Unauthorized
        content: '{"error":"AuthenticationException","message":"Invalid Credentials"}'
      - status: 422
        description: Unprocessable Entity
        content: '{"error":"Please provide your ''Api-Key'' header. You can obtain an API key from VanMoof. For more information see the documentation: http:\/\/api.vanmoof-api.com\/apidoc\/my\/pretty","message":"Please provide an API key"}'

  - httpMethods: [ "POST" ]
    uri: v8/token
    metadata:
      title: Refresh Token
      description: Refresh the authentication token using a refresh token.
      authenticated: false
    headers:
      Api-Key: fcb38d47-f14b-30cf-843b-26283f6a5819
      Content-Type: application/json
    bodyParameters:
      refreshToken:
        name: refreshToken
        description: The refresh token to generate a new authentication token.
        type: string
        required: true
    responses:
      - status: 200
        description: Success
        content: >
          {
            "token": "eyXXX.eyXXX"
          }
      - status: 401
        description: Invalid Refresh Token
        content: '{"error":"AuthenticationException","message":"Invalid Credentials"}'
      - status: 401
        description: Missing API Key
        content: '{"error":"UnexpectedError","message":"An unexpected error occurred. Please contact support if this problem persists."}'